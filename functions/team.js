const departmentMembers = {
    "Wet": [
        {
            "japaneseName": "佐藤凜奈",
            "name": "Linna Sato",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/LinnaSato/150/150",
            "description": "脳や医学に興味があり、学生団体の運営や学術オリンピックに挑戦中。世界一を目指して頑張ります。",
            "roles": [
                "Team Leader admin"
            ]
        },
        {
            "japaneseName": "江川陸翔",
            "name": "Rikuto Egawa",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/RikutoEgawa/150/150",
            "description": "糖尿病の研究をしている17歳。iGEMの目標は世界一。合成生物学で社会課題に本気で向き合います。<br>With full commitment, I am eager to change the world with the beauty of synthetic biology, and contribute in alleviating hay fever symptoms.",
            "roles": [
                "Team Leader",
                "Wet Leader",
                "admin"
            ]
        },
        {
            "japaneseName": "上倉綾太",
            "name": "Ryota Kamikura",
            "grade": "H2",
            "photo": "https://lh3.googleusercontent.com/d/1-JsXV87yKTjp_YFpYZdzRcun5bCvhupb",
            "description": "脳神経科学に関心を持ち学生団体などで活動中。iGEMはいい成果をあげられるよう、全力で頑張ります！<br>Passionate about neuroscience and planning to pursue it. Through iGEM, I hope to achieve meaningful results and enjoy the journey. As one of the team leaders, I aim to support and inspire my team throughout the project.",
            "roles": [
                "Team Leader",
                "admin"
            ]
        },
        {
            "japaneseName": "木内和奏",
            "name": "Wakana Kiuchi",
            "grade": "H2",
            "photo": "https://lh3.googleusercontent.com/d/1ZdczBq4eocVQDhwjRpzEGnIaCHZG9P9-",
            "description": "医学に興味があります。iGEMでは自分の知識を深めながらチームに貢献できるよう頑張ります！<br>I'm passionate about medicine, especially immunology and cardiology. Through iGEM, I hope to deepen my scientific knowledge, gain valuable research experience, and contribute to the team to achieve successful results.",
            "roles": []
        },
        {
            "japaneseName": "中村麻椰",
            "name": "Maya Nakamura",
            "grade": "H1",
            "photo": "https://picsum.photos/seed/MayaNakamura/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "茂木ひなた",
            "name": "Hinata Motegi",
            "grade": "H1",
            "photo": "https://picsum.photos/seed/HinataMotegi/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "姜準",
            "name": "Jun Kang",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/JunKang/150/150",
            "description": "",
            "roles": [
                "Wet Sub Leader"
            ]
        },
        {
            "japaneseName": "武内友里",
            "name": "Yuri Takeuchi",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/YuriTakeuchi/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "小野寺弘輝",
            "name": "Kohki Onodera",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/KohkiOnodera/150/150",
            "description": "化学に興味があります。全力で頑張ります！",
            "roles": []
        }
    ],
    "Hardware": [
        {
            "japaneseName": "長井寅ノ介",
            "name": "Toranosuke Nagai",
            "grade": "M3",
            "photo": "https://lh3.googleusercontent.com/d/1vWKd0usTddfTMJYJII6jeyU8Tkdmr_Zj",
            "description": "航空宇宙工学と機械工学とカヌー・スラロームがとても好きです。このチームを３Dプリンティングの技術でサポートします！<br>I love Aero-Astro and mechanical engineering, as well as canoe slalom. I'll be supporting the team with outlandish ideas and 3D printing skills.",
            "roles": [
                "Hardware Leader"
            ]
        }
    ],
    "Model": [
        {
            "japaneseName": "乾孝太郎",
            "name": "Kotaro Inui",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/KotaroInui/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "酒巻仁",
            "name": "Jin Sakamaki",
            "grade": "H1",
            "photo": "https://picsum.photos/seed/JinSakamaki/150/150",
            "description": "",
            "roles": [
                "Model"
            ]
        }
    ],
    "Software": [
        {
            "japaneseName": "岡田英虎",
            "name": "Eito Okada",
            "grade": "H2",
            "photo": "https://lh3.googleusercontent.com/d/1XhA1I7nXll8aeUBTTSB-PkgVP64HsnBN",
            "description": "興味分野は航空宇宙工学と量子コンピューティングです。高クオリティのwikiとソフトを作れるように頑張ります。<br>My pursuits are aerospace engineering and quantum computing. I'll try my best to create a nice wiki and software for the team.",
            "roles": [
                "Software・Wiki Leader"
            ]
        },
        {
            "japaneseName": "山藤緑夏",
            "name": "Rona Sando",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/RonaSando/150/150",
            "description": "",
            "roles": []
        }
    ],
    "Education": [
        {
            "japaneseName": "成田響生",
            "name": "Hibiki Narita",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/HibikiNarita/150/150",
            "description": "",
            "roles": [
                "Education Sub Leader"
            ]
        },
        {
            "japaneseName": "水谷綾那",
            "name": "Ayana Mizutani",
            "grade": "H1",
            "photo": "https://lh3.googleusercontent.com/d/1Aa308ie69tCSGWm3Tu1gJ91l_urpUt_z",
            "description": "生物学と化学に興味を持っています。多くの人に合成生物学の面白さを広められるように全力で頑張ります！<br>I hope to make a positive impact in people's view of synthetic biology through collaboration with my teammates. I will do my best to support the team!",
            "roles": [
                "Education Leader"
            ]
        },
        {
            "japaneseName": "戸塚美穂",
            "name": "Miho Totsuka",
            "grade": "M2",
            "photo": "https://lh3.googleusercontent.com/d/1FcrhgHFjqxFx2L6iv6OzweL2L1ZE9gUi",
            "description": "チーム最年少メンバーとして何事にも全力で挑戦し、HG-Tokyoに貢献できるように頑張ります！<br>As HG-Tokyo’s youngest member, I’m eager to tackle every challenge and contribute wherever I can.",
            "roles": []
        },
        {
            "japaneseName": "成田香公",
            "name": "Kakou Narita",
            "grade": "H3",
            "photo": "https://picsum.photos/seed/KakouNarita/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "西田芽生",
            "name": "Mei Nishida",
            "grade": "H3",
            "photo": "https://picsum.photos/seed/MeiNishida/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "大原彩加",
            "name": "Ayaka Ohara",
            "grade": "H3",
            "photo": "https://picsum.photos/seed/AyakaOhara/150/150",
            "description": "タンパク質などの分子生命に興味があります。できるサポート頑張りたいと思います!",
            "roles": []
        },
        {
            "japaneseName": "酒巻仁",
            "name": "Jin Sakamaki",
            "grade": "H1",
            "photo": "https://picsum.photos/seed/JinSakamaki/150/150",
            "description": "",
            "roles": [
                "Model"
            ]
        },
        {
            "japaneseName": "清水麻莉花",
            "name": "Marika Shimizu",
            "grade": "H3",
            "photo": "https://picsum.photos/seed/MarikaShimizu/150/150",
            "description": "心理学・公衆衛生学・メディアに興味があります。合成生物学の知名度を高めるために頑張ります！<br>I'm interested in the intersection of psychology, public health, and media awareness. I hope more people can learn about synthetic biology through this project!",
            "roles": []
        }
    ],
    "Human Practice": [
        {
            "japaneseName": "木村直翔",
            "name": "Naoto Kimura",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/NaotoKimura/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "小野恵理",
            "name": "Eri Ono",
            "grade": "H1",
            "photo": "https://lh3.googleusercontent.com/d/1L2NVRlazrunB7ZM_bwIdNr1YOrtF49h-",
            "description": "生物に興味があり追求するため挑戦しました。たくさんの方と関わることが好きです、頑張ります。<br>Exploring the field of synthetic biology myself, I hope to further spread its power to the world. I'm going to give it my best and cherish this journey working with the team!",
            "roles": []
        },
        {
            "japaneseName": "大辺真矢",
            "name": "Maya Obe",
            "grade": "H1",
            "photo": "https://lh3.googleusercontent.com/d/1yIO9JNvDNF7SYTs5IrEbw7lIZy3ZGErk",
            "description": "環境とジャーナリズムに興味を持っています。いろんな人とインタビューをして、このプロジェクトと社会の橋渡しになれるよう頑張ります。<br>I'm interested in the environment and journalism. I hope to contribute to this project by connecting our ideas with society through interviews as a human practice member.",
            "roles": []
        },
        {
            "japaneseName": "廣實真仁",
            "name": "Masato Hirozane",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/MasatoHirozane/150/150",
            "description": "普段は経済・金融・ビジネスに興味があり、iGEMを通じて実践力と国際視野を身につけたいです。",
            "roles": [
                "Hupra and Finance Leader"
            ]
        },
        {
            "japaneseName": "小山夏帆",
            "name": "Kaho Koyama",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/KahoKoyama/150/150",
            "description": "",
            "roles": [
                "Hupra Sub Leader"
            ]
        }
    ],
    "Wiki": [
        {
            "japaneseName": "岡田英虎",
            "name": "Eito Okada",
            "grade": "H2",
            "photo": "https://lh3.googleusercontent.com/d/1XhA1I7nXll8aeUBTTSB-PkgVP64HsnBN",
            "description": "興味分野は航空宇宙工学と量子コンピューティングです。高クオリティのwikiとソフトを作れるように頑張ります。<br>My pursuits are aerospace engineering and quantum computing. I'll try my best to create a nice wiki and software for the team.",
            "roles": [
                "Software・Wiki Leader"
            ]
        },
        {
            "japaneseName": "佐々木初",
            "name": "Ui Sasaki",
            "grade": "M3",
            "photo": "https://lh3.googleusercontent.com/d/1bUr2-8tqxoUGIVfu_ALp2jfB_G4TvKpn",
            "description": "webdevとかアプリ系のものを作るのが好きです。サイバーセキュリティーも趣味として♪ 最強なウェブサイト絶対作り上げます！！<br>I love to make new apps and websites! I also do cybersecurity as a hobby, but I will work very hard to make the best website out there:D",
            "roles": []
        },
        {
            "japaneseName": "山藤緑夏",
            "name": "Rona Sando",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/RonaSando/150/150",
            "description": "",
            "roles": []
        }
    ],
    "広報": [
        {
            "japaneseName": "木内和奏",
            "name": "Wakana Kiuchi",
            "grade": "H2",
            "photo": "https://lh3.googleusercontent.com/d/1ZdczBq4eocVQDhwjRpzEGnIaCHZG9P9-",
            "description": "医学に興味があります。iGEMでは自分の知識を深めながらチームに貢献できるよう頑張ります！<br>I'm passionate about medicine, especially immunology and cardiology. Through iGEM, I hope to deepen my scientific knowledge, gain valuable research experience, and contribute to the team to achieve successful results.",
            "roles": []
        },
        {
            "japaneseName": "和佐野花帆",
            "name": "Kaho Wasano",
            "grade": "H2",
            "photo": "https://lh3.googleusercontent.com/d/1IyKzFOhDed1RJGqPVHaZ0o2cMuqrRv7z",
            "description": "メディアコミュニケーションに興味があります。みんなの活動をしっかり伝えられるよう頑張ります！<br>Fascinated by study of media communications. I'll try my best to promote the team as the great people they are.",
            "roles": [
                "PR Leader"
            ]
        }
    ],
    "Design": [
        {
            "japaneseName": "新明結",
            "name": "Yui Shimmyo",
            "grade": "H3",
            "photo": "https://lh3.googleusercontent.com/d/1DFHSLLA9m4OZPs5azjCIyuzwFBQIXR21",
            "description": "主に有尾類の発生・繁殖行動の研究をしています。このチームの最大限の魅力が引き出せるようなデザインを提供できるよう頑張ります！<br>Interested in Japan's native species and threatened organisms. I will do my best to support the team's image and other departments. I truly believe this team has the potential to achieve great results!",
            "roles": [
                "Design Leader"
            ]
        },
        {
            "japaneseName": "大原彩加",
            "name": "Ayaka Ohara",
            "grade": "H3",
            "photo": "https://picsum.photos/seed/AyakaOhara/150/150",
            "description": "タンパク質などの分子生命に興味があります。できるサポート頑張りたいと思います!",
            "roles": []
        }
    ],
    "財務": [
        {
            "japaneseName": "木村直翔",
            "name": "Naoto Kimura",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/NaotoKimura/150/150",
            "description": "",
            "roles": []
        },
        {
            "japaneseName": "戸塚美穂",
            "name": "Miho Totsuka",
            "grade": "M2",
            "photo": "https://lh3.googleusercontent.com/d/1FcrhgHFjqxFx2L6iv6OzweL2L1ZE9gUi",
            "description": "チーム最年少メンバーとして何事にも全力で挑戦し、HG-Tokyoに貢献できるように頑張ります！<br>As HG-Tokyo’s youngest member, I’m eager to tackle every challenge and contribute wherever I can.",
            "roles": []
        },
        {
            "japaneseName": "廣實真仁",
            "name": "Masato Hirozane",
            "grade": "H2",
            "photo": "https://picsum.photos/seed/MasatoHirozane/150/150",
            "description": "普段は経済・金融・ビジネスに興味があり、iGEMを通じて実践力と国際視野を身につけたいです。",
            "roles": [
                "Hupra and Finance Leader"
            ]
        },
        {
            "japaneseName": "大原彩加",
            "name": "Ayaka Ohara",
            "grade": "H3",
            "photo": "https://picsum.photos/seed/AyakaOhara/150/150",
            "description": "タンパク質などの分子生命に興味があります。できるサポート頑張りたいと思います!",
            "roles": []
        }
    ]
};

document.addEventListener('DOMContentLoaded', function() {
    const departmentsOverview = document.getElementById('departments-overview');
    const memberModal = document.getElementById('member-modal');
    const modalMemberPhoto = document.getElementById('modal-member-photo');
    const modalMemberName = document.getElementById('modal-member-name');
    const modalMemberDescription = document.getElementById('modal-member-description');
    const modalCloseButton = document.querySelector('.member-modal-close');

    function renderDepartmentsAndMembers() {
        const existingDepartmentSections = departmentsOverview.querySelectorAll('.department-section');
        existingDepartmentSections.forEach(section => section.remove());

        const departmentOrder = ["Wet", "Hardware", "Model", "Software", "Education", "Human Practice", "Wiki", "広報", "Design", "財務", "Entrepreneurship"];

        departmentOrder.forEach(departmentName => {
            let members = departmentMembers[departmentName];

            if (members && members.length > 0) {
                members.sort((a, b) => {
                    const getRank = (member) => {
                        if (member.roles.some(role => role.includes("Leader"))) {
                            return 1;
                        }
                        if (member.roles.some(role => role.includes("Sub Leader"))) {
                            return 2;
                        }
                        return 3;
                    };

                    const rankA = getRank(a);
                    const rankB = getRank(b);

                    if (rankA < rankB) return -1;
                    if (rankA > rankB) return 1;
                    return 0;
                });

                const departmentSection = document.createElement('div');
                departmentSection.classList.add('department-section');

                const departmentHeading = document.createElement('h2');
                departmentHeading.classList.add('department-section-heading');
                departmentHeading.textContent = `${departmentName}`;

                const memberListGrid = document.createElement('div');
                memberListGrid.classList.add('member-list-grid');

                members.forEach(member => {
                    const memberCard = document.createElement('div');
                    memberCard.classList.add('member-card');
                    
                    const gradeLabelHtml = `<span class="member-grade-label grade-${member.grade}">${member.grade}</span>`;
                    let roleLabelsHtml = '';
                    if (member.roles && member.roles.length > 0) {
                        roleLabelsHtml = member.roles.map(role => `<span class="member-role-label">${role}</span>`).join('');
                    }

                    const descriptionHtml = member.description.trim() !== '' ? `<p class="member-description">${member.description}</p>` : '';

                    memberCard.innerHTML = `
                        <img src="${member.photo}" alt="${member.name}のプロフィール写真" class="member-photo">
                        <h3 class="member-name">${gradeLabelHtml} ${member.japaneseName} (${member.name})</h3>
                        ${roleLabelsHtml}
                        ${descriptionHtml}
                    `;
                    memberCard.addEventListener('click', () => openMemberModal(member));
                    memberListGrid.appendChild(memberCard);
                });

                departmentsOverview.appendChild(departmentSection);
                departmentSection.appendChild(departmentHeading);
                departmentSection.appendChild(memberListGrid);
            }
        });
    }

    renderDepartmentsAndMembers();

    function openMemberModal(member) {
        modalMemberPhoto.src = member.photo;
        modalMemberPhoto.alt = `${member.name}のプロフィール写真`;
        
        // Updated: Use innerHTML to apply grade styling in the modal
        modalMemberName.innerHTML = `<span class="member-grade-label grade-${member.grade}">${member.grade}</span> ${member.japaneseName} (${member.name})`;
        
        let fullDescription = '';
        if (member.roles && member.roles.length > 0) {
            fullDescription += `役割: ${member.roles.join(', ')}<br>`;
        }
        if (member.description.trim() !== '') {
            fullDescription += member.description;
        }
        modalMemberDescription.innerHTML = fullDescription;
        
        modalMemberPhoto.onerror = function() {
            this.src = `https://placehold.co/150x150/aabbcc/ffffff?text=${member.name.charAt(0)}`;
        };

        // NEW CODE: Prevent body scrolling and handle scrollbar space
        const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
        if (scrollbarWidth > 0) {
            document.body.style.paddingRight = `${scrollbarWidth}px`;
        }
        document.body.classList.add('modal-open');

        memberModal.style.display = 'flex';
    }

    function closeMemberModal() {
        memberModal.style.display = 'none';

        // NEW CODE: Remove body class and reset padding
        document.body.classList.remove('modal-open');
        document.body.style.paddingRight = ''; // Reset padding
    }

    modalCloseButton.addEventListener('click', closeMemberModal);
    memberModal.addEventListener('click', (event) => {
        if (event.target === memberModal) {
            closeMemberModal();
        }
    });

    // Mobile menu toggle (assuming these exist elsewhere in your HTML)
    const hamburgerMenu = document.querySelector('.hamburger-menu');
    const nav = document.querySelector('.nav');

    if (hamburgerMenu) {
        hamburgerMenu.addEventListener('click', () => {
            hamburgerMenu.classList.toggle('active');
            nav.classList.toggle('nav-open');
        });
    }

    // Dropdown menu toggle for mobile (assuming these exist elsewhere in your HTML)
    const dropdownMenu = document.querySelector('.dropdown-menu > .nav-link');
    const dropdownContent = document.querySelector('.dropdown-content');

    if (dropdownMenu && dropdownContent) {
        dropdownMenu.addEventListener('click', (event) => {
            if (window.innerWidth <= 900) { // Only for mobile view
                event.preventDefault(); // Prevent default link behavior
                dropdownContent.classList.toggle('dropdown-open');
            }
        });
    }
});
